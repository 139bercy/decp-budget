---
title: "Prévision budgétaire et données de la commande publique"
author: "Jules Rostand"
date: "19 novembre 2021"
output:
  pdf_document:
    extra_dependencies:
      footmisc: bottom
      InriaSerif: lining
  html_document:
    df_print: paged
  word_document: default
lang: fr-FR
abstract: Cette note présente la méthodologie et les résultats de l'étude des données
  de la commande publique au service de l'activité de prévision budgétaire. Menée  pour
  répondre à une commande de la direction du Budget, cette exploration des données
  essentielles de la commande publique permet de produire une estimation de l'effet
  de la hausse de l'inflation sur les dépenses d'achats de l'État. En parvenant à
  estimer la part des marchés à prix fermes à 30% dans la structure d'ensemble des
  marchés de l'État, cette note évalue les conséquences d'un choc d'inflation de 1%
  à 70 millions d'euros pour la période du 1er juillet 2021 au 30 juin 2022, et suggère
  des pistes d'améliorations pour l'utilisation des données essentielles de la commande
  publique au sein des ministères économiques et financiers.
urlcolor: blue
linkcolor: blue
filecolor: blue
numbersections: yes
toc: yes
fontsize: 11pt
thanks: 'Note d''information : Sécrétariat général des ministères économiques et financiers
  (SG)/DSI/BercyHub.'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

# Introduction

## Contexte et problématique

La direction du Budget s'intéresse, dans le cadre de ses activités de prévision budgétaire, à la modélisation de l'impact de l'inflation sur les dépenses d'achats de l'État. À l'heure actuelle, les données de l'exécution budgétaire ne sont toutefois pas liées avec les engagements juridiques pris en amont. Sans connaissance de la nature et des caractéristiques des contrats à l'origine de ces dépenses, la prévision budgétaire en matière d'achats de l'État est par conséquent rendue particulièrement délicate. 

Conséquence d'une politique volontariste en faveur de l'*open data*, les données essentielles de la commande publique (DECP) sont désormais accessibles en ligne. Celles-ci sont consolidées par la direction des affaires juridiques (DAJ) du secrétariat général (SG) des ministères économiques et financiers et par l'Agence pour l'information financière de l'État (AIFE), avant d'être enrichies par le BercyHub (SG/DSI). En s'inscrivant dans la lignées des études agrégées menées par l'Observatoire économique de la commande publique (OECP)[^5], l'exploration détaillée de ces données représente une piste susceptible d'enrichir l'exercice de prévision de la direction du Budget.

[^5]: Les chiffres-clefs de la commande publique sont publiés sur le site de l'OECP, à l'adresse : <https://www.economie.gouv.fr/daj/oecp-recensement-economique-commande-publique>. Pour les données antérieures, voir les archives des chiffres clefs à l'adresse : <https://www.economie.gouv.fr/daj/oecp-archives-recensement>.

La direction du Budget souhaite disposer d'une simulation de l’effet qu’aurait un « choc d’inflation » sur les marchés publics conclus par l'État. L'hypothèse retenue pour ce scénario fictif est une hausse de 1 point de l'inflation (IPCH hors tabac) sur 12 mois entre le 1er juillet 2021 et le 30 juin 2022. Pour répondre à cette question, cette note s'intéresse aux formes de prix des marchés de commande publique, qui peuvent être « fermes », « fermes et actualisables » ou « révisables »[^11]. Le décret n° [2018-1075](https://www.legifrance.gouv.fr/loda/id/LEGIARTI000037718558/2018-12-06/) du 3 décembre 2018 portant partie réglementaire du code de la commande publique, qui définit un prix ferme comme « un prix invariable pendant la durée du marché », précise toutefois que ces prix fermes peuvent être actualisés, mais uniquement à la suite d'un délai supérieur à trois mois entre la date de fixation et l'exécution effective des prestations[^13]. En ce sens, contrairement aux marchés révisables qui peuvent être modifiés pour « tenir compte des variations économiques »[^14], les marchés à prix fermes sont, en quelque sorte, « isolés » d'une évolution non-anticipée du contexte macroéconomique, et notamment de l'inflation. C'est en mesurant la part des marchés conclus à prix fermes dans l'ensemble des commandes publiques de l'État qu'il s'agit donc d'apporter une meilleure précision à l'exercice de prévision budgétaire.

[^11]: Les formes de prix des marchés publics sont définis par le [Code de la commande publique](https://www.legifrance.gouv.fr/codes/texte_lc/LEGITEXT000037701019/2021-11-17) qui établit à son article  [R2112-8](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000037730973) une distinction entre les prix fermes et les prix révisables au sein des marchés à prix définitifs.

[^13]: Code de la commande publique, art. [R2112-11](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000037730965).

[^14]: Code de la commande publique, art. [ R2112-13](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000037955789).

## Sources et méthodologie

Les données essentielles de la commande publique (DECP) sont disponibles en *open source* sur la plateforme du ministère, à l'adresse : <https://data.economie.gouv.fr/explore/dataset/decp_augmente/table>[^17]. Par la collaboration avec la direction du Budget, ces données sont filtrées pour conserver uniquement les marchés publiés par l'AIFE et les acheteurs relevant du périmètre de l'État[^4]. Dans un souci de qualité des données, les marchés publiés avant 2018 ont été exclus. Le jeu de données de référence pour cette analyse est, à la date de l'étude, un tableau contenant 24 041 lignes et 28 colonnes. 

[^17]: Un monitoring de ces données est accessible en ligne : <https://139bercy.github.io/decp-monitoring/#dashboard>. Celles-ci font actuellement l'objet d'un audit de qualité, dont les premiers résultats sont disponibles à l'adresse : <https://share.streamlit.io/139bercy/decp-qualite/main>.

Après une première étape de traitement en Python, les données essentielles de la commande publique sont étudiées ici en R. Un ensemble de techniques d'analyse de données est mis en œuvre, de l'étude de séries temporelles à la représentation graphique. L'ensemble des opérations préalables et des résultats présentés dans cette note sont disponibles sur le dépôt du projet, sur le GitHub du ministère[^10]. 

[^10]: L'accès à ce dernier, réservé aux membres du BercyHub, peut être sollicité auprès de l'administrateur ministériel des donnés : <https://github.com/139bercy/decp-budget>.

[^4]: Plus précisément, les marchés relatifs aux identifiants et aux noms des acheteurs de ce périmètre, à savoir les Ministères, directions centrales, etc., selon une liste établie par le bureau 2PERF. Pour le détail de ces opérations, voir *supra*, la section 2.2. 

```{r intro, echo=FALSE, message=FALSE}
# Librairies génériques
library(readr)
library(dplyr)
library(ggplot2)

# Statistiques descriptives
library(lubridate)
library(pastecs)

# Détections de ruptures
library(GGally)
library(ggfortify)
library(changepoint)

########################
## Import des données ##
########################

# DECP
read_delim(file = "res/decp_aife_etat_post2018_marche.csv", 
           delim = ";", 
           escape_double = FALSE, 
           col_types = cols(codeCPV_Original = col_character(),
                            codeCPV_division = col_character(), 
                            dateNotification = col_datetime(format = "%Y-%m-%d"), 
                            anneeNotification = col_double(), 
                            datePublicationDonnees = col_datetime(format = "%Y-%m-%d"), 
                            montant = col_number(), montantCalcule = col_number(), 
                            idAcheteur = col_character(), 
                            dateFinCalculee = col_date(format = "%Y-%m-%d"), 
                            mensualiteEstimee = col_number()), 
           locale = locale(date_names = "fr", decimal_mark = ","), 
           trim_ws = TRUE) -> decp_aife_etat_post2018_marche
```

L'ensemble des analyses et des résultats proposés dans cette note dépendent de l'exhaustivité et de la qualité des données essentielles de la commande publique. En dépit des stratégies de correction et de normalisation, la pertinence des résultats repose sur la représentativité des données en entrée. De ce fait, cette analyse exploratoire appelle à être confrontée à des études plus approfondies, qui intègre en particulier une maîtrise de l'ensemble de la chaîne de production de la donnée[^15].

[^15]: En suivant une démarche inspirée de la sociologie de la quantification, dont Alain Desrosières a mis en évidence l'importance dans son ouvrage *La politique des grands nombres* (Paris : La Découverte, 1993), où celui-ci reconstitue l'histoire de la « raison statistique », l'histoire de la mise en chiffres par l'État.

# Pour l'étude des formes de prix des dépenses d'achats de l'État, une étude détaillée des données essentielles de la commande publique est nécessaire

L'étude des formes de prix des dépenses d'achats de l'État représente une demande nouvelle, à laquelle il est difficile d'obtenir une réponse au regard des études actuellement disponibles. Dans ce contexte, une méthodologie spécifique a été développée, pour construire une période et un ensemble de données cohérent à partir des données essentielles de la commande publique.

## La structure des dépenses d'achats de l'État est incertaine

La structure des dépenses d'achats de l'État n'est, à l'heure actuelles, pas retranscrite dans les données de l'exécution budgétaire. Les premières études sur les données essentielles de la commande publique menées par l'OECP doivent de ce fait être prolongées.

### L'absence de lien entre les commandes publiques et l'exécution budgétaire

Comme indiqué en introduction, les données de l'exécution budgétaire ne permettent pas d'obtenir une vue détaillée des dépenses de la commande publique. En effet, il apparaît difficile de reconstruire le périmètre correspondant aux marchés publics à partir des données du budget de l'État, comme le met en évidence l'essai mené ci-dessous. 

Afin de retrouver les commandes publiques, les données de l'exécution budgétaire, transmises par la direction du Budget, sont filtrées de la manière suivante : 

- sur l'ensemble du périmètre des ministères, à l'exception de celui des Armées, faisant l'objet d'une modélisation spécifique ;
- sur les comptes budgétaires 31, 51 et 52, c'est-à-dire les dépenses e fonctionnement, les dépenses d’investissement corporels et les dépenses d’investissement incorporels ;
- sur les comptes généraux, en suivant les recommandations de la direction du Budget.

À la suite de cette procédure, les données obtenues sur le budget se décrivent de la manière suivante :

```{r stats_desc_budget, echo=FALSE, message=FALSE}
# Import des données d'exécution budgétaire
read_delim(file = "data/decp-budget_clean/budget_civil_fonctionnement_general.csv",
           delim = ";",
           col_types = cols(EUR = col_number()), 
           escape_double = FALSE,
           trim_ws = TRUE) -> budget

budget %>%
  select(EUR) %>%  
  stat.desc() -> budget_stats

# Présentation en Rmarkdown
knitr::kable(budget_stats, caption = "Statistiques descriptives des données de l'exécution budgétaire", 
             align = "lr", 
             digits = 2, 
             format.args = list(big.mark = " ", scientific = FALSE))
```

Ces statistiques descriptives mettent en avant une très grande hétérogénéité statistique dans ces paiements, avec des valeurs extrêmement élevées (un maximum à 4e+12), des valeurs négative importantes, et une somme totale de 102 mille milliards, largement supérieure en-cela au budget de l'État, qui dispose d'environ 200 milliards d'euros en recettes nettes[^9]. 

[^9]: Voir par exemple le budget prévisionnel du projet de loi de finances 2021, accessible en ligne : <https://www.budget.gouv.fr/budget-etat>.

L'exploration des données par nature révèle notamment une diversité des paiements retenus, avec par exemple une importante part des dépenses de personnel. Les dépenses d'achats sont en seconde position dans l'ordre descendant, avec 10 mille milliards de paiements. Ce sont aussi les paiements les plus nombreux, avec 260 mille paiements recensés.

```{r stats_desc_budget_nature, echo=FALSE, message=FALSE}
# Etude des sommes totales par nature
budget %>%
  group_by(Nature) %>%
  summarise(nombre = n(), tot = sum(EUR)) %>%
  arrange(desc(tot)) -> budget_nature

# Présentation en Rmarkdown
knitr::kable(budget_nature, caption = "Statistiques descriptives des données de l'exécution budgétaire", 
             align = "lrr", 
             digits = 2, 
             format.args = list(big.mark = " ", scientific = FALSE))
```

Avec des ordres de grandeurs largement supérieurs au budget de l'État lui-même, reflet de la nature de ces données de transcation, il apparaît en l'état difficile de parvenir à identifier dans les données de l'exécution budgétaire, en dépit des traitements proposés ici, les dépenses relatives à la commande publique.

### Les valeurs de référence de l'OECP

L'Observatoire économique de la commande publique (OECP) publie des chiffres clefs regroupant l'État et le secteur hospitalier. Dans se version de 2020, ceux-ci indiquent ainsi un total de 24 139 contrats, pour un montant total de 35 milliards d'euros[^8].

[^8]: OECP, "Chiffres clefs 2020", octobre 2021, s. 5, accessible à l'adresse : <https://www.economie.gouv.fr/files/files/directions_services/daj/marches_publics/oecp/recensement/recensement_chiffres2020_20211012.pdf>.

```{r stats_desc_oecp, echo=FALSE, message=FALSE}
# Import des chiffres clefs
read_delim(file = "data/oecp/oecp_chiffres-clefs-decp-2020_octobre-2021.csv",
           delim = ";", 
           escape_double = FALSE,
           skip = 1,
           locale = locale(date_names = "fr", decimal_mark = ","), 
           trim_ws = TRUE) -> oecp

# Présentation en Rmarkdown
knitr::kable(oecp, caption = "Chiffres clefs 2020 de l'OECP", 
             align = "lrrr", 
             digits = 2, 
             format.args = list(big.mark = " ", scientific = FALSE))
```

Si les études annuelles de l'OECP permettent d'obtenir un ordre de grandeur de la commande publique, celles-ci nécessitent toutefois d'être prolongées pour répondre au besoin de la direction du Budget. En l'absence de distinction entre État et secteur hospitalier, il n'est en effet pas possible d'établir un ordre de grandeur des dépenses d'achats de l'État. En outre, si ces études fournissent des indications sur l'évolution des prix, celles-ci ne permettent pas de connaître la part de marchés à prix fermes dans la commande publique. Dès lors, une étude spécifique des données essentielles de la commande publique est nécessaire.

## Une étude spécifique des DECP est nécessaire

Pour mener cette nécessaire étude spécifique des données essentielles de la commande publique, il faut construire une période et un ensemble cohérent pour ces dernières. Les données essentielles de la commande publique connaissent en effet dimportantes évolutions en nombre et en montant, dont a table ci-dessous retrace les variations[^6].

[^6]: La variable "montant" correspond à la somme des montants déclarés, tandis que la variable "montant calculé" correspond à la somme des montants corrigés par le BercyHub, dans le cadre du [projet DECP augmentées](https://github.com/139bercy/decp-augmente). L'ensemble des transformations effectuées est disponible dans la documentation de ce projet, et reprises dans la documentation générale sur les données essentielles de la commande publique, accessible à l'adresse : <https://139bercy.github.io/decp-docs/>.

```{r stat_desc_oecp, echo=FALSE, message=FALSE}
library(tibble)
decp_aife_etat_post2018_marche %>%
  group_by(anneeNotification) %>%
  summarise(nombre = n(), montant_reporte = sum(montant), montant_calcule = sum(montantCalcule)) %>%
  column_to_rownames(var = "anneeNotification") -> res01

knitr::kable(res01, caption = "Statistiques descriptives des DECP", align = "lrrr", digits = 2, format.args = list(big.mark = " ",
  scientific = FALSE))
```

Cette présentation synthétique permet d'établir un ordre de grandeur du nombre annuel de marchés à 8 000, et un montant total de ces derniers à 10 milliards d'euros. Après avoir étudié l'évolution temporelle des marchés de la commande publique, il est possible de travailler dans le détail sur la répartition des formes de prix.

### La définition d'une période d'étude

Sur le périmètre de l'État, les données de la commande publique mettent en avant une forte hausse du nombre de marchés publiés en accès ouvert. Cette hausse est le reflet de la mise en place de la politique d'ouverture des données, tandis que la baisse à la fin de la période s'explique notamment par les délais de publication de passation des marchés, qui se prolongent parfois largement au-delà des délais fixés.

```{r plot_nombre_contrats_mensuel, echo=FALSE, message=FALSE}
decp_aife_etat_post2018_marche %>% 
  group_by(date = floor_date(dateNotification, "month")) %>%
  summarise(nombre = n()) %>%
  ggplot() +
    geom_line(aes(x = date, y = nombre)) +
    labs(x = "", y = "", 
         title = "Nombre de marchés mensuels", 
         subtitle = "par date de notification") +
    theme_minimal() +
    theme(legend.position="top", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5), 
          plot.subtitle = element_text(size = 8, hjust = 0.5))
```

A l'aide d'une approche algorithmique[^1], une période de stabilité du nombre de contrats est identifée. Au cours de ces près de deux années et demi, le nombre mensuel de contrat oscille aux alentours de 750, avec un écart-type de 177. La représentation graphique proposée ici met en avant la relative stabilité du nombre de contrat sur la période.

[^1]: La détection de ruptures au sein de cette série temporelle s'opère ici en moyenne et en variance, avec un nombre minimum de 5 segments (soit, ici,  5 mois). La librairie employée ici, avec la méthode "PELT" pour un critère d'information bayésien (BIC) avec une distribution normale, est proposée par R. Killick, P. Fearnhead & I. A. Eckley (2012), "Optimal Detection of Changepoints With a Linear Computational Cost", *Journal of the American Statistical Association*, 107:500, 1590-1598, DOI: 10.1080/01621459.2012.737745, accessible à l'adresse : <https://arxiv.org/abs/1101.1438>.

```{r changepoints, echo=FALSE, message=FALSE}
# Agrégation par mois
# nombre de contrats par date de notification ...
decp_aife_etat_post2018_marche %>%  
  group_by(date = floor_date(dateNotification, "month")) %>%
  mutate(date = as.Date(date)) %>%
  summarise(metrics = n()) -> delta_nombre

# Transformation des données en format de séries temporelles (ts, pour time series)
# en nombre ...
ts(delta_nombre$metrics, 
   start = c(2018, 1, 1), end = c(2021, 7, 1), 
   freq = 12) -> delta_nombre.metrics

# Mise en exergue des périodes de stabilité, avec  des ruptures en moyenne et en variance
# en nombre ...
cpt.meanvar(delta_nombre.metrics, 
            method = "PELT",
            penalty = "BIC", 
            test.stat = "Normal", 
            minseglen=5) -> delta_nombre.metrics.res

plot(delta_nombre.metrics.res, 
     main = "Périodisation", 
     xlab = "", ylab = "nombre")
```

C'est sur cet intervalle temporel, qui court de la fin de l'année 2018 au début de l'année 2021, que l'on poursuit cette analyse exploratoire.

```{r nmbre_smooth, echo=FALSE, message=FALSE}
# On conserve la période située entre la première et la seconde rupture de la série en nombre
STARTING = date_decimal(decimal_date(as.Date("2018-01-01")) + cpts(delta_nombre.metrics.res)[1]/12)
ENDING = date_decimal(decimal_date(as.Date("2018-01-01")) + cpts(delta_nombre.metrics.res)[2]/12)

decp_aife_etat_post2018_marche %>%
  subset(dateNotification > STARTING & dateNotification < ENDING) -> decp_work

# Représentation graphique du nombre de contrats, avec une mise en avant de la tendance
decp_work %>%
  group_by(date = floor_date(dateNotification, "month")) %>%
  summarise(nombre = n()) %>%
  ggplot(aes(x = date, y = nombre)) +
    geom_line() +
    geom_smooth() +
    ylim(0, 1200) +
    labs(x = "", y = "", 
         title = "Nombre de marchés mensuels (périodisation stable)", 
         subtitle = "par date de notification") +
    theme_minimal() +
    theme(legend.position="top", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5), 
          plot.subtitle = element_text(size = 8, hjust = 0.5))
```

### L'étude des formes de prix

Pour répondre à l'exercice de prévision budgétaire, une étude des formes de prix est nécessaire. En prenant une échelle trimestrielle à même de rendre compte de la structure des commandes de l'administration, on calcule la part du montant des contrats à prix fermes dans les dépenses de la commande publique. Sur la période, celle-ci diminue sensiblement, passant de 25% à 12,5%, comme le met en évidence le graphique ci-dessous.

```{r formes_prix_nombre, echo=FALSE, message=FALSE}
# Répartition du nombre de contrats
decp_work %>% 
  select(c(dateNotification, formePrix)) %>%
  group_by(date = floor_date(dateNotification, "3 months"), formePrix) %>%
  summarise(total = n()) %>%
  mutate(percentage = total / sum(total)) %>%
  ggplot(aes(x = date, y = percentage, fill = formePrix)) + 
    geom_area(alpha = 0.6 , size = 0.1, colour = "black") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en proportion", 
         title = "Évolution temporelle de la répartition des formes de prix des contrats de la commande publique",
         subtitle = "nombre de contrats trimestriels, par date de notification") + 
    theme_minimal() +
    theme(legend.position="top", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5), 
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))
```

Cette décroissance de la part des marchés à prix fermes dans la commande publique masque toutefois une importante hétérogénéité dans la valeur totale de chacune des formes de prix des contrats. Les valeurs manquantes (NA) représentent en effet les commandes les plus importantes en volume, avec des pics identifiés en décembre 2018 et en janvier 2021 par exemple[^3].

[^3]: Plus précisément, il s'agit de 6% des contrats, pour 48% des sommes totales.

```{r formes_prix_valeur, echo=FALSE, message=FALSE}
# Valeur par forme de contrat
decp_work %>% 
  select(c(dateNotification, formePrix, montantCalcule)) %>%
  group_by(date = floor_date(dateNotification, "month"), formePrix) %>%
  summarise(total = sum(montantCalcule)) %>%
  ggplot(aes(x = date, y = total, fill=formePrix)) + 
    geom_bar(stat = "identity") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en euros", 
         title = "Évolution temporelle de la valeur des formes de prix des contrats de la commande publique",
         subtitle = "montants des contrats mensuels, par date de notification") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))  
```

Parmi les valeurs manquantes (NA) pour les formes de prix, ce sont essentiellement des marchés d'accords cadres qui représentent un montant important (948 identifiés, pour un total estimé de 14 137 617 085 €), comme le met en évidence le tableau ci-après. 

```{r, echo=FALSE, message=FALSE}
decp_work %>%
  group_by(nature, formePrix) %>%
  summarise(n = n(), total = sum(montantCalcule)) -> res02

knitr::kable(res02, caption = "Nombre et montant des DECP par nature de marché et par forme de prix", align = "llrr", digits = 2, format.args = list(big.mark = " ",
  scientific = FALSE))
```

En excluant les NA, on obtient une répartition de la somme des contrats par formes de prix davantage homogène, représentée graphiquement ci-dessous. Celle-ci met en évidence la prépondérance des marchés à prix révisables, et le caractère exceptionnel de la fin de l'année 2019, où la part du montant des marchés à prix ferme a atteint un maximum de 50%.

```{r formes_prix_horsna, echo=FALSE, message=FALSE}
decp_work %>%
  subset(formePrix != "NA") -> decp_work_marche

decp_work_marche %>% 
  select(c(dateNotification, formePrix, montantCalcule)) %>%
  group_by(date = floor_date(dateNotification, "3 months"), formePrix) %>%
  summarise(total = sum(montantCalcule)) %>%
  mutate(percentage = total / sum(total)) %>%
  ggplot(aes(x=date, y=percentage, fill=formePrix)) + 
    geom_area(alpha=0.6 , size=0.1, colour="black") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en pourcentage", 
         title = "Évolution temporelle de la répartition des formes de prix des contrats de la commande publique",
         subtitle = "part trimestrielle des formes de prix des contrats, par date de notification") + 
    theme_minimal() +
    theme(legend.position="top", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5), 
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))
```

Après avoir étudié, puis exclu les valeurs manquantes (NA), l'on dispose d'un ensemble de données davantage cohérent pour répondre à la commande relative à la prévision budgétaire.

# La modélisation de la structure des paiements de la commande publique permet de produire un essai de prévision budgétaire

À partir de ces données, stables sur la période définie et cohérentes du point de vue des formes de prix, il est possible de construire une estimation de la structure de la commande publique. Cette reconstruction de la structure de ces données en matière de forme de prix, permet, dans un second temps, de produire une estimation de l'effet du choc d'inflation sur les dépenses d'achats de l'État.

## La modélisation de la structure des paiements de la commande publique

```{r preparation_mensualite, echo=FALSE, message=FALSE}
# DECP avec estimation des paiements mensuels
read_delim(file = "res/mensualite.csv",
           delim = ";", escape_double = FALSE, 
           col_types = cols(dateNotification = col_datetime(format = "%Y-%m-%d"), 
                            anneeNotification = col_double(), 
                            datePublicationDonnees = col_datetime(format = "%Y-%m-%d"), 
                            montant = col_number(), montantCalcule = col_number(), 
                            idAcheteur = col_character(), 
                            dateFinCalculee = col_date(format = "%Y-%m-%d"), 
                            mensualiteEstimee = col_number(),
                            dt = col_datetime(format = "%Y-%m-%d")), 
           locale = locale(date_names = "fr", decimal_mark = ","), 
           trim_ws = TRUE) -> mensualite

mensualite %>%
  subset(dateNotification > STARTING & dateNotification < ENDING) -> mensualite_work

mensualite_work %>%
  subset(formePrix != "NA") -> mensualite_work_marche
```

L'évolution dans la répartition des formes de prix de la commande publique d'État a jusque-là été étudié du point de vue de la seule date de notification du contrat. Pour répondre à la demande de la direction du Budget, il faut établir une projection de l'exécution budgétaire. À cette fin, des estimations de mensualités des paiements, définies à partir de la durée estimée du contrat et du montant calculé, sont construites. Ces projections de l'exécution budgétaire sont d'abord analysées de manière temporelle, avant de servir à dégager une structure générale de la commande publique.

### La construction de la valeur annuelle des paiements

Les mensualités théoriques construites permettent de produire une estimation de l'exécution budgétaire. Le graphique ci-dessous agrège par année ces paiements théoriques à effectuer chaque mois aux fournisseurs.

```{r estimation_paiements, echo=FALSE, message=FALSE}
# Représentation graphique du montant annuel des mensualités
mensualite_work_marche %>% 
  select(c(dt, formePrix, mensualiteEstimee)) %>%
  group_by(date = floor_date(dt, "year"), formePrix) %>%
  summarise(total = sum(mensualiteEstimee)) %>%
  ggplot(aes(x = date, y = total, fill=formePrix)) + 
    geom_bar(stat = "identity") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en euros", 
         title = "Évolution temporelle de la valeur des formes de prix des contrats de la commande publique",
         subtitle = "montants annuel des contrats, par date de paiement des mensualités") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))
```

La distribution annuelles des dépenses budgétaires théorique représentée ci-dessus graphique fait état d'une diminution graduelle des dépenses avec le temps. Cette réduction s'explique simplement par le fait que la passation de commandes s'effectue au fur et à mesure, et non pas pour l'ensemble des années à venir. Concrètement, le cycle de la commande publique est identifié à 4 années par la direction du Budget de la commande publique, pour un renouvellement de l'essentiel des marchés. Dans le cadre de cette étude, c'est la période du début de l'année 2019 à la fin de l'année 2022 qui sera dès lors retenue, et sur lesquelles on construit la répartition annuelle des formes de prix, en nombre et en montant, représentée ci-dessous.

```{r cycle, echo=FALSE, message=FALSE}
# Construction d'un agrégat annuel des paiements de la commande publique
START_CYCLE = as.Date("2018-12-31")
END_CYCLE = as.Date("2023-01-01")

mensualite_work_marche %>% 
  select(c(dt, formePrix, mensualiteEstimee)) %>%
  group_by(dt = floor_date(dt, "year"), formePrix) %>%
  summarise(nombre = n(), total = sum(mensualiteEstimee)) %>%
  mutate(part_nombre = nombre / sum(nombre), part_montant = total / sum(total)) %>%
  subset(dt > START_CYCLE & dt < END_CYCLE) -> mensualite_work_marche_cycle

# Point de vue diachronique
# En nombre...
mensualite_work_marche_cycle %>% 
  ggplot(aes(x = dt, y = part_nombre, fill=formePrix)) + 
    geom_bar(stat = "identity") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en euros", 
         title = "Évolution temporelle du nombre des formes de prix des contrats de la commande publique",
         subtitle = "montants annuel des contrats, par date de paiement des mensualités") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))

# ... et en montant
mensualite_work_marche_cycle %>% 
  ggplot(aes(x = dt, y = part_montant, fill=formePrix)) + 
    geom_bar(stat = "identity") + 
    scale_fill_brewer(na.value = "grey50") +
    labs(x = "", y = "en euros", 
         title = "Évolution temporelle de la valeur des formes de prix des contrats de la commande publique",
         subtitle = "montants annuel des contrats, par date de paiement des mensualités") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))
```

Sur ce cycle de quatre années, la part du nombre de paiements pour les marchés à prix fermes, qui diminue de manière croissante, est comprise dans un intervalle entre 10 et 20% du nombre total de paiements annuels. En montant, cette part est également décroissante sur la période, et reste comprise dans un intervalle entre 15 et 25%, avec une part exceptionnellement élevée de 30% pour l'année 2020. 

### La répartition par formes de prix des paiements

Sur ces quatre années, il est possible de construire la répartition de la part de chacune des formes de prix dans le nombre et le montant des marchés de l'État. Après avoir établi les ordres de grandeur de cette structure théorique, l'analyse détaillée de la diminution croissante de la part des marchés à prix fermes dans l'ensemble des marchés de l'État permet de définir une valeur de référence pour cette étude.

Les deux graphiques ci-dessous proposent tout d'abord, en nombre et en montant, une représentation graphique de la distribution de la part de chacune des formes de marchés de la commande publique d'État. Reprenant de manière synthétique les graphiques d'évolution temporelle de la répartition des formes de prix, ces deux graphiques permettent de fixer un ordre de grandeur de la structure de la commande publique. En nombre comme en montant, les marchés à prix révisables représentent 70% des commandes d'État, tandis que les prix fermes et les prix fermes et actualisables correspondent respectivement à 20 et 10% de ces dernières.

```{r cycle_synchro, echo=FALSE, message=FALSE}
# Point de vue synchronique
# Distribution, sur les quatre années, de la part des mensualités par forme de prix ...
mensualite_work_marche_cycle %>%
  mutate(ormePrix <- as.factor(formePrix)) %>%
  ggplot(aes(x=formePrix, y=part_nombre)) + 
    geom_boxplot() +
    labs(x = "", y = "part du nombre estimé de paiements", 
         title = "Distribution de la part annuelle du nombre de paiements pour les marchés de la commande publique",
         subtitle = "nombre annuel des estimations de paiements mensuels par formes de prix, pour les quatre années") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))

# ... et distribution, sur les quatre années, de la part du montant des mensualités par forme de prix
mensualite_work_marche_cycle %>%
  mutate(ormePrix <- as.factor(formePrix)) %>%
  ggplot(aes(x=formePrix, y=part_montant)) + 
    geom_boxplot() +
    labs(x = "", y = "part du montant estimé des paiements", 
         title = "Distribution de la part annuelle du montant des paiements pour les marchés de la commande publique",
         subtitle = "montant annuel des estimations de paiements mensuels par forme de prix, pour les quatre années") + 
    theme_minimal() +
    theme(legend.position="bottom", legend.title=element_blank(), 
          plot.title = element_text(size = 10, face = "bold", hjust = 0.5),
          plot.subtitle = element_text(size = 8, hjust = 0.5),
          axis.title.y = element_text(size = 8))
```

À partir de ces ordres de grandeur, il est alors possible de définir ensuite une valeur de référence pour cette étude. Pour ce faire, l'analyse détaillée du rapport entre formes de prix et durées du marchés est nécessaire, afin de prendre en compte la diminution croissante de la part des marchés à prix fermes dans l'ensemble des marchés de l'État.

Les statistiques descriptives mettent en évidence une durée moyenne et médiane largement supérieure pour les contrats révisables, par rapport aux contrats à prix fermes et à prix fermes et actualisables. Cette statistique est le reflet de la pratique de la commande publique, où les marchés à prix fermes sont conclus sur des plus petites durées. Pour la prévision d'exécution budgétaire effectuée ici, cela signifie qu'à mesure que l'on projette la situation actuelle dans l'avenir, le nombre de contrats à prix fermes diminue. En d'autres termes, la réduction en nombre et en montant des marchés à prix fermes sur la période 2019 à 2022 s'explique par la nature même de ces contrats, qui tendent à porter sur des durées courtes et à être conclus peu de temps avant leur exécution.

```{r stats_desc_formes_prix, echo=FALSE, message=FALSE}
# Statistiques descriptives des durées de marchés par formes de prix
decp_work_marche %>% 
  select(c(formePrix, dureeMoisCalculee)) %>%
  na.omit %>% 
  group_by(formePrix) %>%
  summarise(
    moyenne=mean(dureeMoisCalculee),
    std.dev=sd(dureeMoisCalculee),
    min=min(dureeMoisCalculee), 
    q1 = quantile(dureeMoisCalculee, 0.25),
    médiane=median(dureeMoisCalculee),
    q3 = quantile(dureeMoisCalculee, 0.75),
    max=max(dureeMoisCalculee)) -> res03

knitr::kable(res03, caption = "Statistiques descriptives des durées de marchés par formes de prix", align = "lrrrrrr", digits = 2, format.args = list(big.mark = " ",
  scientific = FALSE))
```

Dans le cadre de cette analyse, il semble tout d'abord pertinent de retenir à la fois la part de marchés à prix fermes et celle de marchés à prix fermes et actualisables, ceux-ci étant également non-sensibles à l'inflation. En outre, les valeurs hautes du début de période correspondent davantage à cette étude que les valeurs de fin de période, du fait de la structure de la commande publique. En restant conservateur, l'hypothèse d'une part de 30% des marchés à prix fermes dans l'ensemble des marchés de la commande publique semble pouvoir être retenue.

## Un essai de prévision budgétaire

À partir de cette hypothèse, il est possible de construire un essai de prévision budgétaire. Après avoir présenté une estimation du surcroit de dépenses, les limites de cet exercice de prévision sont identifiées.

### Le surcroit de dépenses de l'État

Le scénario retenue pour cette dernière est celui d'une hausse de 1 point de l'inflation (IPCH hors tabac) sur 12 mois entre le 1er juillet 2021 et le 30 juin 2022. Cette période correspond à une année entière ; on peut dès lors faire une seconde hypothèse, à savoir que la structure de la commande publique sur cette période est identique à celle dégagée ci-dessus pour une année civile, en l'absence d'effets de seuils identifiés en fin d'année pour ces dernières. 

En retenant une somme annuelle de 10 milliards d'euros, ce scénario théorique aurait donné, en l'absence d'étude des formes de prix, une hausse des dépenses publiques de 100 millions d'euros pour la période. En prenant en compte la part des prix fermes de 30% en nombre et en montant, cela signifie que l'évolution de l'inflation ne s'applique en théorie qu'à 7 milliards d'euros en exécution budgétaire. Dès lors, une hausse supplémentaire de 1% de l'inflation génère un surcroit de dépense de 70 millions d'euros. Cet exercice méthodologique permet donc de préciser la précision budgétaire, en revoyant de 30 millions d'euros à la baisse l'effet de la hausse d'inflation sur les dépenses d'achats de l'État.

### Les perspectives de la prévision budgétaire

Cette prévision budgétaire, rendue possible par l'ensemble de la chaîne de publication, de traitement et de diffusion des données essentielles de la commande publique, a permis de se saisir des spécificités de ces données. En effet, le développement d'une méthodologie spécifique, à même de répondre à la demande de la direction du Budget, met à jour un certain nombre d'évolutions souhaitables de ces données. 

1. À court terme, le suivi et l'audit de qualité des données essentielles de la commande publique, actuellement en cours au sein du BercyHub, gagnerait à être pérennisé, afin d'intégrer dans ses indicateurs de suivi les remontées des besoins des utilisateurs de ces données, comme ici pour la direction du Budget ;
2. À moyen terme, le schéma de publication des données essentielles de la commande publique, défini par la direction des affaires juridiques de Bercy, pourrait utilement intégrer la catégorie d'administration publique à l'origine du marché, distinguant ainsi les administrations publiques centrales (APUC), les administrations publiques locales (APUL) et les organismes de sécurité sociale (ASSO) ;
3. À long terme, l'établissement d'un lien entre les données de la commande publique et d'exécution budgétaire semble représenter un objectif particulièrement souhaitable, en prévoyant l'intégration par l'Agence pour l'informatique financière de l'État, d'une correspondance entre identifiants de passation de marchés et numéros d'engagements juridiques.

# Conclusion

Afin de répondre à l'interrogation de la direction du Budget sur les effets d'un choc d'inflation sur les dépenses d'achats de l'État, il est apparu nécessaire de développer une étude détaillée des données essentielles de la commande publique. A partir de ces données, traitées par la direction des affaires juridiques, l'Agence pour l'informatique financière de l'État et le BercyHub, il a été possible de construire une étude spécifique des formes de prix des marchés. 

Cette exploration des données essentielles de la commande publique a permis de construire une estimation, en nombre et en montant, des marchés ne réagissant pas à l'inflation -- les marchés à prix fermes -- à 30% de l'ensemble des marchés de l'État. Avec cette structure de la commande publique définie, et un ordre de grandeur estimé à 10 milliards d'euros par an pour l'État, il est dès lors possible d'estimer l'effet de la hausse de l'inflation d'un point sur un an. La hausse des dépenses est de ce fait estimée à 70 millions d'euros, 30% de moins que la hausse estimée en l'absence de cette étude. 

Si cette prévision pourrait s'améliorer dans les années à venir, avec un historique plus important et un accroissement continu de la qualité des données, celle-ci met dès à présent en valeur l'intérêt que représente la publication de ces données, de même que l'interaction croisée entre expertise budgétaire et compétences en analyse de données.
